# Runtime and Performance Analytics

In this chapter, we discuss the field of performance and runtime analytics. This chapter does not
cover the entire field because it is too broad. Using Kitchenham’s method
[@kitchenham2004procedures], we have narrowed down the scope of this survey.

For inspiration, we started reading five recent papers on runtime and performance analytics
published at top conferences. These five were selected because the papers handle the software side
of performance and runtime analytics which is more in line with the other chapters of this book.
However, focussing on only software, the field is still very broad. We have chosen to focus on the 
field of performance vs. Energy consumption. This chioce was made due to it being a very current and
thriving domain within Runtime and performance analysis.

## Introduction
Energy consumption plays a big role in day-to-day usage of software. Especially in the field of 
software development for mobile devices, for which energy consumption results in a negative effect 
on the battery duration and hence limiting the usage time of the device. Although the importance of 
energy efficient software is clear, programmers lack the knowledge of the best practices to reduce 
software energy consumption, and education is not focused on this field either [ref:PHA2016]. In an 
analysis of questions posted on StackOverflow on the topic of energy efficiency performed by Pinto 
et. al. [ref:PCL2014] it was found that although programmers had questions related to energy 
efficiency, they rarely got the appropriate advice. 
With over 2 billion daily smartphone and tablet users worldwide [ref:NPPPZL2017] it is clear that 
this lack of knowledge needs to be addressed. To help the programmers close this knowledge gap, 
hardware-based tools have been introduced. These tools can determine the energy profile of an 
application with high precision, but it means the costly hardware components need to be 
acquired[ref:NPPPZL2017]. Software-based solutions solve the problem of requiring expensive 
hardware, and are easier to use, but also less precise. 

In this chapter the current state of energy efficiency in software development for mobile devices 
will be analysed. This research will be conducted by following three research questions:

* **RQ1:** What is the state of the art of energy efficiency in software development for mobile 
devices?
* **RQ2:** What is the state of practice for energy efficiency in software development for mobile 
devices?
* **RQ3:** What future work needs to be researched in the field of energy efficiency in software 
development for mobile devices?

In the following paragraph the methodology of the research will be elaborated. After that each 
research questions will be answered in a separate paragraph. In the last paragraph of this chapter 
the conclusion on energy efficiency in software development for mobile devices will be made.


##Methodology
In order to find answers to the research questions, over 30 papers in the field have been selected. 
These papers have been found by searching on Google Scholar with a set of filters. First off, only 
papers from the following journals and conference are selected:

* ACM Transactions on Software Engineering Methodology (TOSEM),
* Empirical Software Engineering (EMSE),
* IEEE Transactions on Software Engineering (TSE),
* Information and Software Technology (IST),
* Journal of Systems and Software (JSS),
* ACM Computing Surveys (CSUR),
* Foundations of Software Engineering (SIGSOFT FSE),
* International Conference on Automated Software Engineering (ASE),
* Working Conference on Mining Software Repositories (MSR)
* Symposium on Operating Systems Design and Implementation (OSDI)

The following criteria is given by the activity and relative newness of the field. The preference is
given to papers which are published not too long ago, preferably after 2012. But if well cited, and 
with interesting findings, older papers can also be used.

Given these two criteria the following search queries have been used:

* "Android AND Energy Efficiency AND Software"
* "Energy AND Android AND Runtime AND Analysis AND performance AND Software"

From the selected papers some backward and forward references have also been selected, to get a 
complete picture. All papers are also checked for relevance to the topic.

To answer **RQ1** a more in-depth look at available tools for the energy efficiency is performed. 
The focus for **RQ2** is on what is currently used in Android application that are actively used. 
**RQ3** is answered by the finding of the papers used for both RQ1 and RQ2.

##State of the Art

Many researchers found that there is increasing demand for energy efficient software. In their 
research they often propose state of the art approaches to assisting developers. These approaches 
can be separated into two main categories: tools and guidelines. This section will contain an 
overview of all state of the art tools and guidelines that satisfy our search criteria 
[REFERENCE TO METHODOLOGY]. This overview is used to  answer RQ1.

_Tools_

  |Reference   |  Tool                |  Description                            |
  |------------|-----------------------|------------------------------------------|
  |CA2018      | Leafactor             | Analyze code smells                      |
  |LWXM2017    | NavyDroid             | Locate energy inefficiencies             |
  |KKK2016     | Static analysis tool  | Identify graphical energy bugs           |
  |SKHA2018    | APOA                  | Compare energy consumption of apps       |
  |BCBR2017    | Energy Patch          | Detect, validate and repair energy leaks |
  |NPPPZL2017B | PETrA                 | Measure energy consumption of apps       |
  |PSCS2018    | jStanley              | Detect and improve energy bugs in java"  |


Most of the state of the art tools can be classified as performing either measurement of energy 
consumption or code analysis. Although plenty of such tools have been proposed, with low citation 
numbers, none of them seem to have had a big influence in the research area. There is, however, the 
possibility, with growing demand for energy efficiency, that the amount and quality of tools will 
increase in the near future. 

_Guidelines_ 

  |Reference | Area  | Description|
  |--------|---------------------------------|--------------------------------------------------------------|
  |MSA2018 | Energy saving coding practices  | Guidelines for energy saving mobile apps |
  |CA2017  | Energy saving coding practices  | Evaluating effectiveness of several energy saving practices  |
  |AKG2015 | Cloud applications  | Guidelines for balancing quality of service and energy consumption |
  |BAW2017 | Parameter optimization  | Learn hardware specific energy models  |
  |MPF2018 & MPF2017 | Cryptography  | Energy consumption of cryptographic primitives |
  |BSB2017 | Software structure  | Relate software structural metric to power consumption |
  |LH2014  | Energy saving coding practices  | Empirical evaluation of commonly suggested practices"  |
  

The guidelines presented in these papers aim to either provide general coding practices or they 
explain how to involve energy efficiency in a specific domain.

##State of Practice
Now that we have an overview of the state of the art regarding energy consumption on Android driven 
mobile devices, we investigate what the current state of practice is. In this section, we try to 
find an answer to RQ2 stated in the introduction by going through the papers we have retrieved using
the methodology described in Section 2. First, we study how different software engineering 
approaches affect energy consumption and if developers have any knowledge or training regarding 
energy saving programming techniques. Furthermore, we try to see if there are any tools being used 
which help decreasing energy consumption. To make this more specific, we divide RQ2 into several 
sub-research questions:

* **SQ1:** What are the current development approaches used in practice and how does that affect 
energy consumption?
* **SQ2:** What do programmers currently know and do about energy saving app development?

###Answering SQ1
Under development approaches, the language used to write the app is one of the things that is taken 
into consideration. There have been a number of studies into the effects of using a certain 
programming language in the applications. Java is still the most used language for Android 
applications. According to Oliveira et al. [ref:OOC2017], Java is actually not a good choice when 
limiting energy consumption is one of your priorities. One of the contributions of the paper is a 
study where hybrid implementations of applications are compared with the original, pure Java 
implementations in terms of energy consumption and performance. The paper suggests that hybrid 
implementations might be a good solution, but the problem is that the study was done on just four 
Android applications. The paper did use the Rosetta Code repository, but this does not represent 
commercial software development.

Another comparable recent research paper investigated the energy-delay product (EDP) which is 
defined as  “a weighted function of the energy consumption and run-time performance 
product” [ref:GKLS2018]:

$E * T^w$

where E is the total energy used to complete a task, T the time and w is a value that represents how
important energy saving is with regard to time. The advantage of using this function is that 
performance is not neglected. The results in the paper show that the programming language should be 
chosen depending on the task. From these results, it is clear that Java is not performing well when 
comparing it to other languages as can be seen Table [ref:to table nr].  However, it should be noted
that the paper does not test this on actual Android applications but rather the Rosetta Code 
repository.

![Programming Languages Average Weighted EDP Ranking, retrieved from [ref:GKLS2018]]
(figures/EDPranking.jpeg)

The above two papers are examples of research that suggest that the current state of practice, 
developing applications in Java only, is not in line with the current state of the art on energy 
efficiency. In spite of these research papers, developers are still working mostly with Java. One 
possible explanation is that Java is simply compatible with almost every system due to the JVM. We 
suggest that further research should investigate why developers are sticking to Java. For example, 
looking at available libraries, coding difficulty and available tools and knowledge might have a 
significant impact on this choice.

###Answering SQ2
In the previous sections we have seen examples of the state of the art, as well as development 
methods that could lead to improvements in energy consumption. However, this knowledge only holds 
value when the community can get developers willing to use these. There have been a number of 
studies that look into what is actually happening.

One example is the paper by Moura et al. [ref:MPEC2015]. In this paper a study is conducted by 
looking at  a large number of energy-aware commits with Github as the primary data source. This 
analysis has yielded a list of approaches that are being used by developers in practice. These 
include: frequency and voltage scaling, using power efficient libraries and more. The study notes 
that the vast majority of the commits focus on the lower levels of the software stack. Furthermore, 
only 16.2% of the commits were related to using more efficient libraries or data structures.  There 
are also a number of software qualities that have been shown to take precedence of the energy 
consumption. These include correctness, responsiveness and performance. Another point which the 
research addressed is whether software developers were certain of their energy saving commits. The 
paper suggests that there are definitely cases where developers are not certain about their energy 
saving change. This might be caused by the fact that there are few user friendly tools available for
aiding developers in making energy-aware decisions. 

##Future research
In this section we will take a look at the suggested future research directions that have been 
mentioned in the papers used in this survey. We attempt to extract some general trend from the 
future research suggestions that are included. One of the fields of research we looked at in the 
previous sections was the relation between programming languages and energy consumption. Multiple 
papers suggest that the programming language used for implementation has an influence on the energy 
consumption and performance [ref:GKLS2018, OOC2017]. These papers however do not look into the 
influence of specific features of the programming languages on energy consumption and performance. 
Or rather the specific characteristics of a programming language that cause the differences, as 
described in the paper by Georgiou et al.

In the investigations of this report, we came across a number of tools which can be used to aid 
developers in their management of the energy consumption of applications. However, to our knowledge, 
there are no studies reporting on the actual use of such tools. For future research, we suggest 
investigating the amount of developers actually using such tools. Furthermore, it is important what 
features such tools should have for optimal use. For example, we replicated the paper that 
introduces jStanley, a tool which can be used for energy and performance 
optimization [ref:PSCS2018]. We faced the issue that this tool cannot implement the suggested 
improvements in an easy and efficient way. For example, we took the AssertJ open source project from 
GitHub and there were more than 300 energy saving suggestions. A user has to click on every 
suggestion to actually implement the improvement which is tedious work.
Similarly, a lot of the papers reporting on tools that could be used in practice are currently being
tested with benchmarks. However, it is always the question whether these benchmarks are 
representative enough of the real world to hold actual merit.

